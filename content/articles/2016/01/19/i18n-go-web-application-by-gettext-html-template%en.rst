i18n Golang Web Application by gettext and html/template
########################################################

:date: 2016-01-19T07:19+08:00
:tags: Go, Golang, i18n, Locale, gettext, html, Web application, web, sed, Regular Expression
:category: Go
:summary: i18n_ (Internationalization) Go_ web applications by GNU gettext_
          tools and `html/template`_. Use PO_ and MO_ files generated by
          gettext_ in Golang_ web application to render HTML of specific
          languages by `html/template`_.


GNU gettext_ tools are great for creating i18n (web) applications. In this post,
assume that PO_ and MO_ files generated by gettext_ are ready. We will use the
PO_ and MO_ files to let Go_ (web) applications to render HTML of specific
languages by `html/template`_. If you do not know what PO_ or MO_ files are, or
you do not know how to create them by gettext_ tools, please read my previous
post [1]_ and [2]_ first.


PO_ and MO_ files
+++++++++++++++++

I will show how to use MO_ and PO_ files by example. In the example, we support
two locale_, *zh_TW (Traditional Chinese)* and *vi_VN (Vietnamese)*. The zh_TW
PO file are located at ``locale/zh_TW/LC_MESSAGES/messages.po`` and vi_VN PO
file are located at ``locale/vi_VN/LC_MESSAGES/messages.po``.

zh_TW PO file ``locale/zh_TW/LC_MESSAGES/messages.po``:

.. show_github_file:: siongui userpages content/code/go-gettext/locale/zh_TW/LC_MESSAGES/messages.po

vi_VN PO file ``locale/vi_VN/LC_MESSAGES/messages.po``:

.. show_github_file:: siongui userpages content/code/go-gettext/locale/vi_VN/LC_MESSAGES/messages.po

Generate corresponding MO files by msgfmt_. Put MO files together with PO files.
So we have two PO files and two MO files:

.. code-block:: txt

  locale/zh_TW/LC_MESSAGES/messages.po
  locale/zh_TW/LC_MESSAGES/messages.mo
  locale/vi_VN/LC_MESSAGES/messages.po
  locale/vi_VN/LC_MESSAGES/messages.mo


Source Code
+++++++++++

Next, we need the `gettext-go`_ package to handle the PO_ and MO_ files for
us. Install `gettext-go`_ by:

.. code-block:: bash

  $ go get github.com/chai2010/gettext-go/gettext

Now we can let Go_ application speak local language:

.. show_github_file:: siongui userpages content/code/go-gettext/html.go

Note that xgettext_ cannot extract translatable strings directly from
``{{gettext "Home"}}``. We can use the method similar to [4]_ by using sed_ to
handle input files first and then feed the output to xgettext_ to extract
translatable strings (read [7]_ for further details):

.. code-block:: bash

  sed "s/{{gettext \(".*"\)}}/{{gettext(\1)}}/g" html.go | xgettext --no-wrap --language=c --from-code=UTF-8 --output=locale/messages.pot -


Output of Above Code
++++++++++++++++++++

.. code-block:: txt

  <span>首頁</span>
  <span>經典</span>
  <span>關於</span>
  <span>設定</span>
  <span>翻譯</span>

  <span>Trang chính</span>
  <span>Kinh điển</span>
  <span>Giới thiệu</span>
  <span>Thiết lập</span>
  <span>Dịch</span>


Tested on: ``Ubuntu Linux 15.10``, ``Go 1.5.3``.

----

References:

.. [1] `Internationalization (i18n) of Web Application by GNU gettext Tools <{filename}../07/i18n-web-application-by-gnu-gettext-tools%en.rst>`_

.. [2] `[Golang] Internationalization (i18n) of Go Application by GNU gettext Tools <{filename}../08/golang-i18n-go-application-by-gnu-gettext%en.rst>`_

.. [3] `xgettext example <https://www.google.com/search?q=xgettext+example>`_

.. [4] `php - Let xgettext find keywords in comments - Stack Overflow <http://stackoverflow.com/questions/7645319/let-xgettext-find-keywords-in-comments>`_

.. [5] `gmarty/xgettext · GitHub <https://github.com/gmarty/xgettext>`_ (Extract translatable strings from Handlebars templates.)

.. [6] `arendjr/grunt-xgettext: Grunt xgettext plugin for JavaScript and Handlebars <https://github.com/arendjr/grunt-xgettext>`_

.. [7] `xgettext Extract Translatable Strings From Golang html/template <{filename}xgettext-extract-translatable-string-from-go-html-template%en.rst>`_


.. _gettext: https://www.gnu.org/software/gettext/
.. _i18n: https://en.wikipedia.org/wiki/Internationalization_and_localization
.. _locale: https://en.wikipedia.org/wiki/Locale
.. _Go: https://golang.org/
.. _Golang: https://golang.org/
.. _html/template: https://golang.org/pkg/html/template/
.. _PO: https://www.gnu.org/software/gettext/manual/html_node/PO-Files.html
.. _MO: https://www.gnu.org/software/gettext/manual/html_node/MO-Files.html
.. _msgfmt: https://www.gnu.org/software/gettext/manual/html_node/msgfmt-Invocation.html
.. _gettext-go: https://github.com/chai2010/gettext-go
.. _xgettext: https://www.gnu.org/software/gettext/manual/html_node/xgettext-Invocation.html
.. _sed: http://www.grymoire.com/Unix/Sed.html
